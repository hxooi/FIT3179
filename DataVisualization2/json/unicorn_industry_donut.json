{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 700,
  "height": 700,
  "title": {
    "text": "Distribution of Unicorn Companies by Industry",
    "fontSize": 14,
    "font": "Verdana"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/hxooi/FIT3179/main/DataVisualization2/data/unicorn_industry_donut_alt.csv"
  },

  "params": [
    {
      "name": "country_selection",
      "bind": {
        "input": "select",
        "options": [
          "All Countries","China","United States","Australia","United Kingdom","Bahamas",
          "India","Indonesia","Turkey","Germany","Hong Kong","Seychelles","Sweden","Mexico",
          "Estonia","Canada","Netherlands","France","Israel","Finland","Colombia","Belgium",
          "Brazil","South Korea","Denmark","Switzerland","Lithuania","Austria","Ireland",
          "Singapore","Vietnam","United Arab Emirates","Argentina","Spain","Japan","Luxembourg",
          "Nigeria","Philippines","Croatia","Senegal","Malaysia","Bermuda","Norway","South Africa",
          "Ecuador","Chile","Thailand","Czech Republic","Italy"
        ],
        "labels": [
          "Show All","China","United States","Australia","United Kingdom","Bahamas",
          "India","Indonesia","Turkey","Germany","Hong Kong","Seychelles","Sweden","Mexico",
          "Estonia","Canada","Netherlands","France","Israel","Finland","Colombia","Belgium",
          "Brazil","South Korea","Denmark","Switzerland","Lithuania","Austria","Ireland",
          "Singapore","Vietnam","United Arab Emirates","Argentina","Spain","Japan","Luxembourg",
          "Nigeria","Philippines","Croatia","Senegal","Malaysia","Bermuda","Norway","South Africa",
          "Ecuador","Chile","Thailand","Czech Republic","Italy"
        ],
        "name": "Select Country: "
      }
    }
  ],

  "transform": [
    {
      "filter": "country_selection != null ? datum.Country == country_selection : datum.Country == 'All Countries'"
    },
    {
      "calculate": "indexof(['Artificial Intelligence','Internet software and services','E-commerce and direct-to-consumer','Fintech','Health','Cybersecurity','Edtech','Hardware'], datum.Industry) >= 0 ? datum.Industry : 'Other'",
      "as": "Industry2"
    },
    { "aggregate": [{"op":"sum","field":"Count","as":"Count"}], "groupby": ["Country","Industry2"] },
    { "joinaggregate": [{"op":"sum","field":"Count","as":"Total"}], "groupby": ["Country"] },
    { "calculate": "(datum.Count / datum.Total) * 100", "as": "pct" },
    { "calculate": "round(datum.pct * 10) / 10", "as": "pct1" },
    { "calculate": "(datum.Count == 1 ? '1 company' : datum.Count + ' companies')", "as": "count_text" },
    { "calculate": "'In ' + datum.Country + ', ' + datum.Industry2 + ' has ' + datum.count_text + ' (' + datum.pct1 + '%).'", "as": "tooltip_sentence" }
  ],

  "encoding": {
    "theta": {"field": "Count", "type": "quantitative", "stack": true},
    "color": {
      "field": "Industry2",
      "type": "nominal",
      "scale": {
        "domain": [
          "Artificial Intelligence",
          "Fintech",
          "Health",
          "Cybersecurity",
          "Internet software and services",
          "E-commerce and direct-to-consumer",
          "Edtech",
          "Hardware",
          "Other"
        ],
        "range": [
          "#357C3C",
          "#C689C6",
          "#A799B7",
          "#FFCCB3",
          "#B7657B",
          "#FE7E6D",
          "#FFD372",
          "#AC66CC",
          "#2541B2"
        ]
      },
      "sort": "ascending",
      "legend": {
        "title": "Industry",
        "orient": "bottom",
        "direction": "horizontal",
        "columns": 2,
        "labelFont": "Verdana",
        "labelFontSize": 18,
        "labelColor": "black",
        "symbolType": "circle",
        "symbolSize": 120,
        "padding": 8,
        "labelLimit": 1000
      }
    },
    "tooltip": {"field": "tooltip_sentence", "type": "nominal", "title": ""}
  },

  "layer": [
    {
      "mark": {
        "type": "arc",
        "outerRadius": 300,
        "innerRadius": 200
      }
    },
    {

      "mark": {
        "type": "text",
        "fontSize": 35,
        "font": "Verdana",
        "color": "black",
        "fontWeight": "bold"
      },
      "encoding": {
        "text": {"field": "Country", "type": "nominal"}
      }
    }
  ],

  "config": {
    "view": {"stroke": null},
    "background": "#F6F6F6"
  }
}
