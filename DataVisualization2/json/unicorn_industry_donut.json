{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 600,
  "height": 700,
  "title": {"text": "Distribution of Unicorn Companies by Industry", "fontSize": 14, "font": "Verdana"},
  "data": {"url": "https://raw.githubusercontent.com/hxooi/FIT3179/main/DataVisualization2/data/unicorn_industry_donut_alt.csv"},

  "params": [{
    "name": "country_selection",
    "bind": {
      "input": "select",
      "options": ["All Countries","China","United States","Australia","United Kingdom","Bahamas","India","Indonesia","Turkey","Germany","Hong Kong","Seychelles","Sweden","Mexico","Estonia","Canada","Netherlands","France","Israel","Finland","Colombia","Belgium","Brazil","South Korea","Denmark","Switzerland","Lithuania","Austria","Ireland","Singapore","Vietnam","United Arab Emirates","Argentina","Spain","Japan","Luxembourg","Nigeria","Philippines","Croatia","Senegal","Malaysia","Bermuda","Norway","South Africa","Ecuador","Chile","Thailand","Czech Republic","Italy"],
      "labels": ["Show All","China","United States","Australia","United Kingdom","Bahamas","India","Indonesia","Turkey","Germany","Hong Kong","Seychelles","Sweden","Mexico","Estonia","Canada","Netherlands","France","Israel","Finland","Colombia","Belgium","Brazil","South Korea","Denmark","Switzerland","Lithuania","Austria","Ireland","Singapore","Vietnam","United Arab Emirates","Argentina","Spain","Japan","Luxembourg","Nigeria","Philippines","Croatia","Senegal","Malaysia","Bermuda","Norway","South Africa","Ecuador","Chile","Thailand","Czech Republic","Italy"],
      "name": "Select Country: "
    }
  }],

  "transform": [
    {"filter": "if(country_selection != null, datum.Country == country_selection, datum.Country == 'All Countries')"},
    {"joinaggregate": [{"op": "sum", "field": "Count", "as": "Total"}]},
    {"calculate": "(datum.Count / datum.Total) * 100", "as": "pct"},
    {"calculate": "round(datum.pct * 10) / 10", "as": "pct1"},
    {"calculate": "(datum.Count == 1 ? '1 company' : datum.Count + ' companies')", "as": "count_text"},
    {"calculate": "'In ' + datum.Country + ', ' + datum.Industry + ' industry has ' + datum.count_text + ' unicorns (' + datum.pct1 + '% of total).'", "as": "tooltip_sentence"},

    {"window": [{"op": "max", "field": "Count", "as": "maxCount"}]},
    {"calculate": "datum.Count == datum.maxCount", "as": "is_top"},


    {"calculate": "'Fintech leads here — ' + datum.pct1 + '% share. Payments, neobanking and fintech infrastructure see the strongest funding and scale.'", "as": "fintech_note"}
  ],

  "encoding": {
    "theta": {"field": "Count", "type": "quantitative", "scale": {"type": "linear"}, "stack": true},
    "color": {
      "field": "Industry",
      "type": "nominal",
      "scale": {
        "domain": ["Artificial Intelligence","Auto and transportation","Consumer and retail","Cybersecurity","Data management and analytics","E-commerce and direct-to-consumer","Edtech","Fintech","Hardware","Health","Internet software and services","Mobile and telecommunications","Other","Supply chain, logistics, and delivery","Travel"],
        "range": ["#357C3C","#85C88A","#E5CB9F","#FFCCB3","#FFAB76","#FE7E6D","#FFD372","#C689C6","#AC66CC","#A799B7","#B7657B","#93ABD3","#7692E4","#3F52E3","#2541B2"]
      }
    },
    "tooltip": {"field": "tooltip_sentence", "type": "nominal", "title": ""}
  },

  "layer": [
    { "mark": {"type": "arc", "outerRadius": 300, "innerRadius": 200} },

    // ★ Bigger, bolder outer labels
    {
      "mark": {"type": "text", "radius": 350, "fontWeight": "bold", "fontSize": 12, "font": "Verdana"},
      "encoding": {
        "text": {"field": "Industry", "type": "nominal"},
        "fillOpacity": {
          "condition": {"test": "datum['Count'] == 93 || datum['Count'] == 224 || datum['Count'] == 242 || datum['Count'] == 106", "value": 1},
          "value": 0
        },
        "color": {"value": "black"}
      }
    },

    // ★ Slightly larger center country label
    {
      "mark": {"type": "text", "fontSize": 26, "fontWeight": "bold", "color": "black", "font": "Verdana"},
      "encoding": { "text": {"field": "Country", "type": "nominal"} }
    },

    // ★ Fintech insight annotation — shows only when Fintech is the top slice
    {
      "transform": [
        {"filter": "datum.Industry == 'Fintech' && datum.is_top"}
      ],
      "layer": [
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "top",
            "dx": 10,
            "dy": 0,
            "x": 340,          
            "y": 120,
            "font": "Verdana",
            "fontSize": 13,
            "fontWeight": "bold"
          },
          "encoding": {
            "text": {"field": "fintech_note", "type": "nominal"},
            "color": {"value": "black"}
          }
        },
        {
          "mark": {
            "type": "rule",
            "x": 300, "x2": 340, "y": 160, "y2": 140,
            "strokeDash": [4,3]
          }
        }
      ]
    }
  ],

  "config": {
    "view": {"stroke": null},
    "background": "#F6F6F6",
    "legend": {"labelFontSize": 11, "labelLimit": 180, "symbolSize": 200}
  }
}
